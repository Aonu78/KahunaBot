<!doctype html>
<html lang="en">
  <head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="static/css/botpro.css">
    <script src="static/js/botscript.js"></script> 
    <!-- Bootstrap CSS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Lato:400,700'
      rel='stylesheet' type='text/css'>
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous">
  </head>
  <body>
    <!-- Copy and paste the below complete div to your site -->


    <!-- start of chatbot -->
    <div id="chatBotOuter">
      <div class="bg-white" id="chatbotWindow">
        <div class="d-flex align-items-center px-3 py-2 header_cls">
          <div class="sc-bdvvaa eRQARU"><div id="onlinestatus"
              class="sc-gsDJrp dmwCdz"></div></div>
          <div class="bQtkcV">Eagle Chat</div>
          <div class="float-right">
            <i class="showPointer fa-solid fa-minus me-3"
              onclick="toggleWindow()" style="transform:translateY(4px)"></i>
            <i class="showPointer fa-solid fa-xmark" onclick="endChat()"></i>
          </div>
        </div>
      <div id="chatBody" class="p-3">
        

      </div>
        <div id="chat_footer" class="footer_div px-3 py-2 align-items-center justify-content-between">
          <div class="flex-fill">
            <textarea type="text"  id="messageBox"
              placeholder="Enter Message"></textarea>
          </div>
          <div class="ms-3">
            <i 
              class="showPointer fa-solid fa-paper-plane"></i>
          </div>
        </div>
        <div class><a><img src="static/img/powerbetterbot - Copy.png" class="sc-gWXaA-D fzBOpH"></a></div>

      </div>
      <div class="text-end" id="minimalBot">
        <div><img id="smallBot" onclick="toggleWindow()"
            class="showPointer removeShadow"
            src="static/img/eagle.png"
            height="72" /></div>
      </div>
    </div>
    <!-- end of chatbot -->


    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"></script>

  </body>
</html>

<!-- it shuld be remain in same file do not place it to other file  -->

<script>
  var html = ''
  var mbox = document.getElementById('messageBox')
  var chatBody = document.getElementById('chatBody')
  var chatbotWindow = document.getElementById('chatbotWindow')
  var minimalBot = document.getElementById('minimalBot')
  var phonebl = false
  var emailbl = false
  var textbl = false
  var inputstart = 0
  var isMax = false
  var isInit = true
  var closeDialog = false
  var sug_nm = 0
  var slid_num = 0
  var name = ''
  var email = ''
  var phone = ''
  var Prev = ''
  var Previous = []
  var tem = 0
  var foulWords = ["shit", "bitch", "cunt", "pussy", "asshole", "gay", "piss", "hell", "fuck", "dick", "cock", "titty", "nigger"]
  var appointment = ''
  var purpose = ''

  var slideIndex = 0
  showDivs(slideIndex)
  
  function plusDivs(n) {
    showDivs(slideIndex += n)
  }
  
  function showDivs(n) {
    var i;
    var x = document.getElementsByClassName("mySlides");
    if (n > x.length) {slideIndex = 1}
    if (n < 1) {slideIndex = x.length}
    for (i = 0; i < x.length; i++) {
      x[i].style.display = "none"  
    }
    try{
      x[(slideIndex-1)].style.display = "block"  
    }
    catch{}
  }
  function toggleWindow() {
    if (isInit) {
      onBotMessage(qa.intro)
      isInit = false
    }
    if (isMax) {
      chatbotWindow.style.display = "none"
      minimalBot.style.display = "block"
    } else {
      chatbotWindow.style.display = "block"
      minimalBot.style.display = "none"
    }
    isMax = !isMax
  }
function subblockdisplay(){
  $("#phonevalid").css("display","block")
}
  function displayhide(positn){
    $('#suggest_bot'+positn).remove()
    $('#Backbtn'+(positn+1)).remove()
    $('#searchbox').remove()
    $('#ratingid').remove()
    $('#d_img').remove()
    $('#images_btn').remove()

  }
  $( document ).ready(async function() {


})
  async function send_email(){

    // two method one for php db and other with email

    // with php example
    // <?php
    //         $db = mysqli_connect(localhost,root,root,hospital) or die ("Opps, Some thing went wrong!");
    //         $today = date('Y-m-d');
    //         mysqli_query($db,"INSERT INTO `view` (`id`, `date`, `device`) VALUES (NULL, '$today', 'mobile' )" ); 
    // ?>

// with API Example
    // # variable are stored in name, phone and email. 
    // # so we can use a API to send these data to make a notofication
    // Example of how api work for it to send data.
    // also tested
    $.post("https://kahonabot-1-r0896406.deta.app/sendmail/",
      {ajax_name:name,
      ajax_email:email,
      ajax_phone:phone,
      ajax_appointment:appointment,
      ajax_purpose:purpose
    },
    function(data,status){
      console.log( "email sended!" )
    });

}

  function getOption(t) {
    var opt = t.target.innerText
    if (opt == ''){opt = t.target.id}
    displayhide(sug_nm-1)
    Prev = opt
    chatBody.innerHTML += onUserMessage(opt)
    if("Live Video" == opt){
      appointment = 'Schedule Appointment'
      purpose = 'For Live Video'
      phonebl = true
      opt = "Name"
    }
    if("Self-Guided" == opt){
      appointment = 'Schedule Appointment'
      purpose = 'For Self-Guided'
      phonebl = true
      opt = "Name"
    }
    if("Phone Call" == opt){
      appointment = 'Schedule Appointment'
      purpose = 'For Phone Call'
      phonebl = true
      opt = "Name"
    }
    if("In-Person" == opt){
      appointment = 'Schedule Appointment'
      purpose = 'For In-Person'
      phonebl = true
      opt = "Name"
    }
    if("Phone" == opt){
      appointment = 'Contact Me'
      purpose = 'For Phone'
      phonebl = true
      opt = "Name"
    }
    if("Email" == opt){
      appointment = 'Contact Me'
      purpose = 'For Email'
      emailbl = true
      opt = "Name"
    }
    if("Text" == opt){
      appointment = 'Contact Me'
      purpose = 'For Text'
      textbl = true
      opt = "Name"
    }
    if("Brochure" == opt){
      appointment = 'Contact Me'
      purpose = 'For Brochure'
      phonebl = true
      opt = "Name"
    }
    
    if ("BACK" == opt){
      if(tem == 1){
        Previous.pop()
        opt = Previous.pop()
        tem = 0
        displayhide(sug_nm)
        inputstart = 0
    }
      else{
        opt = Previous.pop()
        inputstart = 0
      }
    }
    else{
      tem = 1,
      Previous.push(opt)
    }
    // alert(qa[opt]['answer'])
    // alert("@@@@@@@@@@@")
    if (qa[opt] === undefined) return onBotMessage(qa.intro)
    // alert(opt)
    // alert(qa[opt]['answer'])
    onBotMessage(qa[opt])
  }
  function endChat() {
    isInit = true
    mbox.disabled = true
    if (closeDialog) return
    closeDialog = true
    var id = Math.random().toString(36).substring(3)
    var html = `<div class="mt-4 card p-3 text-center" id="${id}">
        <h4 class="pt-2 pb-3">End chat ?</h4>
        <div class="d-flex">
          <button class="btn_color_chat w-100 me-1" onclick="closeDialog = false;closeChat()">OK</button>
          <button class="btn btn-outline-secondary w-100 ms-1" onclick="closeDialog = false;cancelClose('${id}')">Cancel</button>
        </div>
      </div>`
    chatBody.innerHTML += html
    clearScroll()
  }

  function closeChat() {
    chatBody.innerHTML = ""
    mbox.disabled = false
    toggleWindow()
  }

  function cancelClose(id) {
    mbox.disabled = false
    document.getElementById(id).remove()
  }

  function clearScroll() {
    chatBody.scrollTop = chatBody.scrollHeight
    mbox.value = ""
  }

  function enterPressed(e) {
    if (e.which === 13) postMessage()
  }
  function ValidatePhone(phone)
  {
  var mailformat = /^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/;
  if(phone.match(mailformat))
    {
      return true;
    }
  else
    {
      return false;
    }
  }
  function ValidateEmail(email)
  {
  var mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
  if(email.match(mailformat))
    {
      return true;
    }
  else
    {
      return false;
    }
  }
  function ValidateName(name)
  {
  var regName = /^[a-zA-Z]+ [a-zA-Z]+$/;
  if(name.match(regName))
    {
      return true;
    }
  else
    {
      return false;
    }
  }

  function postMessage() {

    try {
      mbox = document.getElementById('valueBox')
    }
    catch{
      mbox = document.getElementById('messageBox')
    }
    var msg = mbox.value.trim()
    if (msg === "") return
 
    if (inputstart == 0){
      if (ValidateName(msg)){
        name = msg
      }
      else{
        $("#namevalid").css("display","block")
        return
      }
      name = msg
      displayhide(sug_nm-1)
      chatBody.innerHTML += onUserMessage(msg) 
      msg = "Phone"
    }
    if (inputstart == 1){
      if (ValidatePhone(msg)){
        email = msg
      }
      else{
        $("#phonevalid").css("display","block")
        return
      }
      phone = msg
      displayhide(sug_nm-1)
      chatBody.innerHTML += onUserMessage(msg) 
      msg = "Email"
    }
    if (inputstart == 2){
      if (ValidateEmail(msg)){
        email = msg
      }
      else{
        $("#emailvalid").css("display","block")
        return
      }
      
      displayhide(sug_nm-1)
      chatBody.innerHTML += onUserMessage(msg) 
      msg = "Thanks"
      inputstart = 0
      emailbl = false
      phonebl = false
      textbl = false
      send_email()
    }
    if (emailbl || phonebl || textbl == true){
      inputstart += 1;
  }
    var lowerCaseMsg = msg
    for (var f of foulWords) {
      var check = lowerCaseMsg.split(" ")
      if (check.indexOf(f) !== -1) {
        onBotMessage({
          answer: "You have a potty mouth! I am taking 5th on this one!"
        })
        return clearScroll()
      }
    }
    if (qa[msg] === undefined) {
      onBotMessage(qa.intro)
    } else {
      onBotMessage(qa[msg])
    }

    clearScroll()

  }
  function onUserMessage(msg) {
    if (msg == '1 Bed'){return `<div class="sc-kDThTU sc-lbhJmS csGJDm lCpMk ImageBubbleWrapper">
          <div class="sc-iNGGwv IZIJi Bubble user-messages" title="selected-image" data="[object Object]">
            <img alt="beds:1 bedrooms image" src="static/img/1bd.png" class="sc-jeqYYF cSTbkS">
          </div>
        </div>`}
    if (msg == 'Call Office For Pricing 812-401-1454'){ return `<div class="sc-jgrIVw gFdBvJ UserMessageContainer">
          <div class="sc-gSQGeZ hBtfkL bubble">
            <span>Call Office For Pricing <a href="tel:8124011454"><div class='sc-bBHHQT cbVbsH circle'><img src='static/img/telephone.png'></div>812-401-1454</a></span>
          </div>
      </div>`}
      else {
      return `<div class="sc-jgrIVw gFdBvJ UserMessageContainer">
                <div class="sc-gSQGeZ hBtfkL bubble">
                  <span>${msg}</span>
                </div>
            </div>`}
    }

  function onBotMessage(args) {
    html = `<div class="botMessageWrap"><div class="row" style="">
        <div class="botName col-2"><img src="static/img/eagle.png" alt="" class="fIpSMA"></div>
        <div class="botMessage col">${args.answer}</div></div>`
        if (args.answer1){
          html += `</div><div class="botMessageWrap"><div class="row" style="">
        <div class="botName col-2"><img src="static/img/blank.png" alt="" class="fIpSMA"></div>
        <div class="botMessage col">${args.answer1}</div></div>`
        }
        if (args.d_img){
      var hrf = args.d_img;
      for (var r of hrf) {

        html += r
    }
    }    
    if (args.related) {
      html += `<div class="suggestions SjQJt" id='suggest_bot`+sug_nm+`'>`
      var related = args.related;
      sug_nm += 1;
      for (var r of related) {
        html += `<div class="suggest showPointer gGlNMg " onclick="getOption(event)">${r}</div>`
      }
    }
    if (args.related1) {
      html += `<div class="suggestions SjQJt" id='suggest_bot`+sug_nm+`'>`
      var related = args.related1;
      sug_nm += 1;
      for (var r of related) {
        html += `<div class="suggest showPointer gGlNMg ">${r}</div>`
      }
    }
    if(args.input){
      html += args.input
    }


      if (args.images){
      var img = args.images;
      for (var r of img) {
        html += `<div class="suggest showPointer" style="border:none;padding-left: 40%;">${r}</div></div>`
    }
      html += `</div></div>`
    }
    if (args.href){
      var hrf = args.href;
      slid_num = 0
      html += `</div>`
      html += `<div class="suggestions" id='suggest_bot`+sug_nm+`' style='margin-bottom: 10px;'>`        
      html += `<div class="w3-display-container">`      
      for (var r of hrf) {
        
        if (slid_num == 0){slid_num += 1;html += `<div class="mySlides" style="display:block"><img src=${r} style="width:100%;height:306px;border-radius: 20px;"><div class="text" style="margin-bottom: -30px;color:#000">${args.caption[slid_num-1]}</div></div> `;}
        else {
        html += `<div class="mySlides" style="display:none"><img src=${r} style="width:100%;height:306px;border-radius: 20px;"><div class="text" style="margin-bottom: -30px;color:#000">${args.caption[slid_num-1]}</div></div>`}
        slid_num += 1
      }
      html += `<button class="w3-button w3-black w3-display-left" onclick="plusDivs(-1)">&#10094;</button>
              <button class="w3-button w3-black w3-display-right" onclick="plusDivs(1)">&#10095;</button>
            </div></div>`

    }
    if (args.img_slide) {
      var related = args.img_slide;

      for (var r of related) {
        
        html += `<div class="suggestions SjQJt" id='suggest_bot`+sug_nm+`'><div class="suggest showPointer" style='border:none;'>${r}</div></div></div></div>`
      }}
      if (args.rating) {
      html += args.rating}
      if (Prev == ''){
      // alert("Greater.............")
    }
    else{
      html += `</div>`

            // html += `<div class="suggestions SjQJt" id='suggest_bot`+sug_nm+`' style="margin-right: 28px;">`
    html += `<div class="sc-pVTma sc-TBWwm kRPzFu lliVEy BackQuickLinkWrapper"><div onclick="getOption(event)" id='Backbtn`+sug_nm+`' class="sc-pVTma kRPzFu TextAppearFromBottom"><div class="sc-bkkfTU llLJZS QuicklinkButton" tabindex="0" role="button"><div class="sc-iqsfdx sc-crHlIS sc-fotPbf gGlNMg ivrzjL dMliuX BackQuickLinkText quickLinks"><div class="sc-ieebsP sc-dJjZJu eNjgfc kszVAv arrow left-arrow"></div><span style="margin-left: 80px;">Back</span></div></div></div></div>`
    // html += `</div>`
  }
    var id = Math.random().toString(36).substring(3)
    chatBody.innerHTML += spinnerBlock(id)
    clearScroll()
    setTimeout(function () {
      document.getElementById(id).remove()
      chatBody.innerHTML += html
      clearScroll()
    }, 2000)
  }


  function spinnerBlock(id) {
    return `<div class="spinnerBlock" id="${id}">
        <div class="spinner-grow" role="status"></div>
        <div class="spinner-grow" role="status"></div>
        <div class="spinner-grow" role="status"></div>
      </div>`
  }
</script>